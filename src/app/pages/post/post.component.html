<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ask a Question - Staging Ground</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <style>

    </style>
</head>


<!-- *ngIf="loggedIn" -->
<div class="button-container animate__animated animate__fadeInDown" *ngIf="user!=null">
    <button id="showFormBtn" class="btn btn-primary pulse" (click)="toggleQuestionForm()">
        <i class="fas fa-question-circle me-2"></i> Ask a Question
    </button>
</div>
<div class="container d-none animate__animated animate__fadeIn" id="questionForm">

    <div class="text-center mb-4">
        <h2 class="fw-bold">Ask a Question in Forum</h2>
        <p class="text-muted">A private space to help new users write their first questions.</p>
    </div>
    <div class="mb-3">
        <label class="form-label fw-bold">Title</label>
        <input type="text" class="title-input" #titleInput
            placeholder="E.g. Is there an R function for finding the index of an element in a vector?" />
    </div>

    <div class="mb-3">
        <label class="form-label fw-bold">What are the details of your problem?</label>

        <div class="toolbar">
            <!-- <button class="btn btn-tool" title="Insert code"><i class="fas fa-code"></i></button> -->
            <div class="input-group-append">
                <button class="btn btn-tool" type="button" (click)="startRecording()"
                    *ngIf="!voiceRecognitionService.isRecording">
                    <i class="fas fa-microphone"></i>
                </button>
                <button class="btn btn-tool" type="button" (click)="stopRecording()"
                    *ngIf="voiceRecognitionService.isRecording">
                    <i class="fas fa-stop"></i>
                </button>
            </div>

            <button class="btn btn-tool" title="Upload image" (click)="fileInput.click()">
                <i class="fas fa-image me-2"></i> <span class="d-none d-md-inline">
                    {{ selectedFileName||'Upload Image' }}</span>
            </button>
            <input type="file" id="image" accept="image/*" (change)="onFileSelected($event)" #fileInput class="d-none">

        </div>
    </div>
    <div class="input-group">
        <textarea class="form-control" #detailsInput id="details" rows="5" (input)="handleType($event)"
            [(ngModel)]="message" (keyup.enter)="submitMessage($event)" (paste)="handleType($event)"
            placeholder="Introduce the problem and expand on what you put in the title. Minimum 20 characters."></textarea>

    </div>


    <div class="d-none mt-2" id="badge">
        <span class="indicator" id="language-indicator" style="background-color: gray;"></span>
        <span id="language-detected"></span>
    </div>

    <div class="text-end mt-3" *ngIf="user!=null">
        <button class="btn-post" (click)="postQuestion()"> <i class="fas fa-paper-plane me-2"></i> Post
            Question</button>
    </div>
</div>
<div class="container animate__animated animate__fadeIn">
    <!-- Post Section -->
    <div class=" post-section">
        <!-- En-tête avec titre et champ de filtrage -->
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h3 class="section-title mb-0">Recent Posts</h3>

            <!-- Champ de filtrage par technologie -->
            <div class="filter-section" *ngIf="technologiesGetted.length!=0">
                <select class="form-select" id="technologySelect" (change)="filterPosts($event)">
                    <option value="">All Technologies</option>

                    <option *ngFor="let tech of technologiesGetted" [value]="tech">{{ tech }}</option>
                </select>
            </div>
        </div>
        <!-- Liste des posts filtrés -->
        <div class="posts-container">

            <div *ngFor="let post of paginatedPosts">
                <div class="post fade-in" (click)="goToPostDetails(post)">
                    <h5>{{ post.title }}</h5>
                    <p>{{ post.content }}</p>
                    <p class="text-muted">
                        <i class="fas fa-user-circle me-1"></i> Posted by
                        {{ usernames[post.user_id] }}
                        <i class="fas fa-clock me-1"></i> {{ post.createdAt }}
                    </p>

                    <div class="d-flex flex-wrap" *ngIf="post.tags.length!=0">
                        <div *ngFor="let l of post.tags | split: ', '">
                            <div style="margin-top: 10px;" id="badge">
                                <span class="indicator" id="language-indicator"
                                    [style.background-color]="getRandomColor()"></span>
                                <span id="language-detected">{{l}}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Message si aucun post -->
        <div *ngIf="posts.length===0" class="d-flex justify-content-center align-items-center">
            <div class="text-center">
                <p class="text-muted">No posts found</p>
            </div>
        </div>

        <!-- Pagination -->
        <nav class="mt-4" *ngIf="posts.length > itemsPerPage" aria-label="Page navigation">
            <ul class="pagination justify-content-center">
                <li class="page-item disabled" [ngClass]="{ disabled: currentPage === 1 }">
                    <a class="page-link" (click)="goToPage(currentPage - 1)" aria-label="Previous">
                        <span aria-hidden="true">&laquo;</span>
                    </a>
                </li>
                <li *ngFor="let page of getPagesArray()" class="page-item" [ngClass]="{ active: page === currentPage }">
                    <a class="page-link" (click)="goToPage(page)">{{ page }}</a>
                </li>
                <li class="page-item" [ngClass]="{ disabled: currentPage === totalPages }">
                    <a class="page-link" (click)="goToPage(currentPage + 1)" aria-label="Next">
                        <span aria-hidden="true">&raquo;</span>
                    </a>
                </li>
            </ul>
        </nav>

    </div>
</div>
<div class="chat-container d-none" id="chatbot">
    <div class="chat-header">
        <h5><i class="fas fa-robot me-2"></i> Staging Ground Assistant</h5>
        <button class="chat-close" id="closeChatBtn" (click)="closeChatBot()"><i class="fas fa-times"></i></button>
    </div>
    <div class="chat-box" #chatBox>
        <div *ngFor="let msg of messages" [ngClass]="{'user': msg.sender === 'user', 'bot': msg.sender === 'bot'}"
            class="message">
            <div class="avatar"><i class="fas fa-robot"></i></div>
            <div class="bubble">{{ msg.text }}</div>
        </div>
        <!-- Typing Indicator -->
        <div *ngIf="isBotTyping" class="message bot">
            <div class="bubble typing-indicator">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
    </div>


    <div class="input-container">
        <input type="text" class="chat-input" [(ngModel)]="userInput" (keypress)="handleKeyPress($event)"
            placeholder="Type a question..." />
        <button (click)="sendMessage()" class="send-btn"><i class="fas fa-paper-plane"></i> Send</button>
    </div>
</div>

<div class="button-chatbot">
    <button id="showChatbotBtn" class="btn btn-primary" (click)="toggleChatbot()"> <i class="fa fa-comment-dots"></i>
        <!-- Font Awesome chat icon --></button>
</div>
<p-toast></p-toast>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>


</html>